---
title: "Modelling Script"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(caret)
control <- trainControl(method="repeatedcv", number = 5, repeats = 1)
library(ggplot2)

install.packages("dummies")
require(dummies)
model <- train(f5k10d ~ t5c13c, data=testYear9, method ="knn", preProcess = "scale", trControl = control)

View(testYear9$f5k10d)

View(testYear9$t5c13c)


View(testYear5)

testYear5 <- head(year5, 100)


testYear9 <- head(year9, 100)




other.testYear9 <- select(year9, t5c13c) %>%  filter(t5c13c > -1, t5c13c < 7)

View(other.testYear9)

View(some.testYear9)

ggplot(some.testYear9, aes(t5c13c, m5k14e)) + geom_point() + geom_jitter(width = .05)

dummyMath <- dummy(other.testYear9$t5c13c)

View(dummyMath)

colnames(dummyMath)

colnames(dummyMath)[1] <- "far below average"
colnames(dummyMath)[2] <- "below average"
colnames(dummyMath)[3] <- "average"
colnames(dummyMath)[4] <- "above average"
colnames(dummyMath)[5] <- "far above average"

colnames(dummyMath)
require(dplyr)
  reduced.df <- df[,col] <- apply(df[,col], 1, filter_(greaterthan0(df[col])))


reduced.df <- Filter(greaterthan0, testYear9[,'f5k14d'])

onlyTwo <- filter(year9, f5k14d >= 0, t5c13c >= 0)
View(onlyTwo)

dummyVideoGame <- RemoveBlank_Dummy(onlyTwo, 'f5k14d')

dummyMath <- RemoveBlank_Dummy(onlyTwo, 't5c13c')

RemoveBlank_Dummy <- function(df, col) {
  reduced.df <- select(df, idnum, col)
  reduced.df <- filter(reduced.df, reduced.df[,col] >= 0)
  View(reduced.df)
  dummyFrame <- dummy(reduced.df[[col]])
  return(dummyFrame)
}

View(fullSet)
```

```{r}

#put all varaibles as numeric to filter
names <- c("m1a11b", "m3c3h", "m3b4d", "m4b4a1", "t5c13c")
fullSet[,names] <- lapply(fullSet[,names], as.numeric) 

#select all survey questions and the outcome variable, filter out negative numbers
otherDummyVars <- select(fullSet, m1a11b, m3c3h, m3b4d, m4b4a1, t5c13c) %>% filter(f5k14d >= 0, m3c3h >= 0, t5c13c >= 0, t5c13c < 6, m1a11b > 0, m3b4d > 0, m4b4a1 > 0)

View(otherDummyVars)

#isolate the survey questions to be dummyfied
myDummyVars <- select(otherDummyVars, m1a11b, m3c3h, m3b4d, m4b4a1)


#put all variables as factors to dummyfy
names <- c("m1a11b", "m3c3h", "m3b4d", "m4b4a1")
myDummyVars[,names] <- lapply(myDummyVars[,names], as.factor)

View(myDummyVars)

#dummyfy the curvey questions. Use the dataframe in which the dummies live (myDummyVars)
dmy <- dummyVars(~ m1a11b + m3b4d + m4b4a1 + m3c3h, data = myDummyVars)

#make the dummy variables into a dataframe and add the outcome column
df_dummy <- data.frame(predict(dmy, newdata = myDummyVars), otherDummyVars$t5c13c)

#takes the top 5 columns
head(df_dummy)

#10 fold cross vaidation repeated 3 times
control <- trainControl(method = "repeatedcv", number = 10, repeats = 3)

#model the data against the outcome variable that lives in the first "dummy" table made, (otherDummyVars)
model <- train(otherDummyVars.t5c13c ~ ., data = df_dummy, method = "knn", trControl = control, tuneLength = 20)

model


```

```{r}
View(dummyMath)



require(caret)
View(dummyVideoGame)

filter?


RemoveBlank_Dummy <- function(df, col) {
  df[,col] <- apply(df[,col], margin = 1, Filter(greaterthan0, df[,col]))
  dummyFrame <- dummy(df[[col]])
  return(dummyFrame)
}

baselineYear9 <- inner_join(baseline, year9)
combine2 <- inner_join(baselineYear9, year1)
combine3 <- inner_join(combine2, year3)
combine4 <- inner_join(combine3, year5)

fullSet <- combine4

test.baselineYear9 <- select(combine4, t5c13c, m3c3h) %>% filter(t5c13c > -1, m3c3h > -1, t5c13c < 7)
View(test.baselineYear9)

x <- select(year9, t5c13c) %>% filter(t5c13c > -1)
View(x)
newdf <- table(test.baselineYear9)

View(newdf)

barplot(height = newdf, beside = T, col=c("aquamarine3","coral", "red", "blue", "green"))
legend("topleft", c("far below average", "below average", "average", "above average", "far above average"), pch=15, 
       col=c("aquamarine3","coral", "red", "blue", "green"), 
       bty="n")

ggplot(data = as.data.frame(newdf), aes(m3c3h, t5c13c)) + geom_point() 

linear_model <- lm(t5c13c ~ m3c3h + m1a11b + m3b4d, data=fullSet)
require(broom)
parameters <- tidy(linear_model)$estimate

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
